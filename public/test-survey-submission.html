<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey Submission Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        .code {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin-top: 10px;
            border: 1px solid #ddd;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #45a049;
        }
        .status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 3px;
            color: white;
            font-size: 12px;
            margin-left: 10px;
        }
        .status.ok { background: #4CAF50; }
        .status.warning { background: #ff9800; }
        .status.error { background: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>📝 설문조사 제출 테스트</h1>
        
        <div class="test-section">
            <h2>문제 분석</h2>
            <p><strong>ID 26의 경우:</strong> 25개 문항 중 마지막 문항(인덱스 24)만 저장됨</p>
            <p><strong>원인:</strong> 페이지네이션으로 인해 현재 보이는 페이지의 input만 form에 포함됨</p>
            <p><strong>해결책:</strong> 모든 응답을 hidden input으로 추가하여 form 제출 시 포함</p>
        </div>
        
        <div class="test-section">
            <h2>테스트 스크립트</h2>
            <button onclick="simulateFullSurvey()">전체 설문 시뮬레이션</button>
            <button onclick="checkFormInputs()">Form Inputs 확인</button>
            <button onclick="clearTestData()">테스트 데이터 초기화</button>
            
            <div class="code" id="testScript">
// 전체 설문 응답 시뮬레이션
function simulateFullSurvey() {
    // 설문 페이지로 이동 후 콘솔에서 실행
    const script = `
// Alpine 컴포넌트 찾기
const component = document.querySelector('[x-data]').__x;

// 설문 시작
component.$data.selectedSurvey = 0;
component.$data.showQuestions = true;
component.$data.analysisType = 'simple';

// 모든 문항에 대해 응답 생성 (25개 문항)
for (let i = 0; i < 25; i++) {
    // 랜덤하게 0-4 중 선택
    component.$data.responses[i] = Math.floor(Math.random() * 5);
}

// 현재 상태 확인
console.log('Total responses:', Object.keys(component.$data.responses).length);
console.log('Responses:', component.$data.responses);

// 마지막 페이지로 이동
const totalPages = Math.ceil(25 / 3);
component.$data.currentPage = totalPages - 1;
component.$data.maxReachedPage = totalPages - 1;

// Form에 hidden inputs 확인
setTimeout(() => {
    const form = document.querySelector('form[method="POST"]');
    const hiddenInputs = form.querySelectorAll('input[type="hidden"][name^="responses"]');
    console.log('Hidden response inputs:', hiddenInputs.length);
    
    hiddenInputs.forEach((input, idx) => {
        console.log(\`Hidden input \${idx}: name=\${input.name}, value=\${input.value}\`);
    });
    
    // 제출 준비 확인
    const allAnswered = component.$data.surveys[component.$data.selectedSurvey].questions.every((q, idx) => 
        component.$data.responses.hasOwnProperty(idx)
    );
    console.log('All questions answered:', allAnswered);
    
    if (allAnswered) {
        console.log('✅ Ready to submit! All 25 questions have responses.');
    } else {
        console.log('❌ Not ready. Some questions are missing responses.');
    }
}, 1000);
`;
    return script;
}
            </div>
        </div>
        
        <div class="test-section">
            <h2>검증 체크리스트</h2>
            <ol>
                <li>✅ 페이지네이션 적용 (3문항씩 표시)</li>
                <li>✅ localStorage에 응답 저장</li>
                <li>✅ 모든 페이지 탐색 후 응답 확인</li>
                <li>✅ Hidden inputs 생성 확인</li>
                <li>✅ Form 제출 시 모든 응답 포함</li>
            </ol>
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        function simulateFullSurvey() {
            const script = `
// ========================================
// 전체 설문 응답 시뮬레이션 스크립트
// ========================================

// Alpine 컴포넌트 찾기
const component = document.querySelector('[x-data]').__x;

// 설문 시작
component.$data.selectedSurvey = 0;
component.$data.showQuestions = true;
component.$data.analysisType = 'simple';

// 모든 문항에 대해 응답 생성 (25개 문항)
for (let i = 0; i < 25; i++) {
    // 모든 문항에 3번 선택 (보통 있음)
    component.$data.responses[i] = 2;
}

// 마지막 페이지로 이동
const totalPages = Math.ceil(25 / 3);
component.$data.currentPage = totalPages - 1;
component.$data.maxReachedPage = totalPages - 1;

// 상태 확인
console.log('========================================');
console.log('설문 응답 시뮬레이션 완료');
console.log('========================================');
console.log('총 응답 수:', Object.keys(component.$data.responses).length);
console.log('현재 페이지:', component.$data.currentPage + 1, '/', totalPages);
console.log('');

// Form 검증
setTimeout(() => {
    const form = document.querySelector('form[method="POST"]');
    const hiddenInputs = form.querySelectorAll('input[type="hidden"][name^="responses"]');
    const radioInputs = form.querySelectorAll('input[type="radio"][name^="responses"]:checked');
    
    console.log('Form 입력 상태:');
    console.log('- Hidden inputs:', hiddenInputs.length);
    console.log('- Radio inputs (checked):', radioInputs.length);
    console.log('- 총 입력:', hiddenInputs.length + radioInputs.length);
    console.log('');
    
    // 제출 가능 여부
    const allAnswered = Object.keys(component.$data.responses).length === 25;
    if (allAnswered) {
        console.log('✅ 제출 준비 완료! 25개 문항 모두 응답됨');
        console.log('');
        console.log('제출하려면:');
        console.log('1. "설문 완료하기" 버튼 클릭');
        console.log('2. 또는 콘솔에서: document.querySelector(\\'button[type="submit"]\\').click()');
    } else {
        console.log('❌ 일부 문항 미응답');
    }
}, 500);
`;
            
            navigator.clipboard.writeText(script).then(() => {
                document.getElementById('result').innerHTML = `
                    <div class="test-section">
                        <span class="status ok">SUCCESS</span>
                        <strong>스크립트가 클립보드에 복사되었습니다!</strong>
                        <ol style="margin-top: 10px;">
                            <li>https://ai-med.co.kr/surveys 페이지 열기</li>
                            <li>F12로 개발자 도구 열기</li>
                            <li>Console에서 Ctrl+V로 붙여넣기</li>
                            <li>Enter로 실행</li>
                            <li>결과 확인 후 "설문 완료하기" 클릭</li>
                        </ol>
                    </div>
                `;
            });
        }
        
        function checkFormInputs() {
            const script = `
// Form inputs 확인
const form = document.querySelector('form[method="POST"]');
if (!form) {
    console.log('❌ Form not found');
    return;
}

const allInputs = form.querySelectorAll('input[name^="responses"]');
const hiddenInputs = form.querySelectorAll('input[type="hidden"][name^="responses"]');
const radioInputs = form.querySelectorAll('input[type="radio"][name^="responses"]');

console.log('=== Form Input Analysis ===');
console.log('Total inputs:', allInputs.length);
console.log('Hidden inputs:', hiddenInputs.length);
console.log('Radio inputs:', radioInputs.length);

// 각 input의 name과 value 출력
const inputMap = new Map();
allInputs.forEach(input => {
    const name = input.name;
    const value = input.value;
    const type = input.type;
    const checked = input.checked;
    
    if (!inputMap.has(name)) {
        inputMap.set(name, []);
    }
    inputMap.get(name).push({ type, value, checked });
});

console.log('\\nInput details:');
inputMap.forEach((inputs, name) => {
    console.log(\`\${name}:\`, inputs);
});
`;
            
            navigator.clipboard.writeText(script).then(() => {
                alert('Form 확인 스크립트가 클립보드에 복사되었습니다!');
            });
        }
        
        function clearTestData() {
            const keys = [
                'survey_1_responses',
                'survey_1_freq_responses',
                'survey_1_page',
                'survey_1_max_page',
                'survey_1_timestamps'
            ];
            
            keys.forEach(key => {
                localStorage.removeItem(key);
            });
            
            alert('테스트 데이터가 초기화되었습니다.');
        }
    </script>
</body>
</html>