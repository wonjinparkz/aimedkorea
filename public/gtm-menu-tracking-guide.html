<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTM 메뉴 클릭 추적 가이드</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 10px;
        }
        h2 {
            color: #1e40af;
            margin-top: 30px;
            padding: 10px;
            background: #eff6ff;
            border-left: 4px solid #2563eb;
        }
        h3 {
            color: #374151;
            margin-top: 20px;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        .highlight {
            background: #fbbf24;
            color: #1f2937;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        .step {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .warning {
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .success {
            background: #f0fdf4;
            border: 2px solid #22c55e;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #e5e7eb;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #f3f4f6;
            font-weight: bold;
        }
        .copy-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            float: right;
            margin-top: -40px;
        }
        .copy-btn:hover {
            background: #1e40af;
        }
        .tab-container {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin: 20px 0;
        }
        .tab-buttons {
            display: flex;
            background: #f3f4f6;
            border-bottom: 1px solid #e5e7eb;
        }
        .tab-button {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
        }
        .tab-button.active {
            background: white;
            color: #2563eb;
            border-bottom: 2px solid #2563eb;
        }
        .tab-content {
            padding: 20px;
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 Google Tag Manager 메뉴 클릭 추적 완벽 가이드</h1>
        
        <div class="success">
            <strong>✅ 현재 상태:</strong> GTM 컨테이너 ID (GTM-N8GJF2QW)가 이미 설치되어 있습니다.
        </div>

        <h2>📋 목차</h2>
        <ol>
            <li><a href="#step1">웹사이트 코드 수정</a></li>
            <li><a href="#step2">GTM 변수 설정</a></li>
            <li><a href="#step3">GTM 트리거 생성</a></li>
            <li><a href="#step4">GTM 태그 생성</a></li>
            <li><a href="#step5">테스트 및 검증</a></li>
            <li><a href="#step6">디버깅 방법</a></li>
        </ol>

        <h2 id="step1">1️⃣ 웹사이트 코드 수정</h2>
        
        <div class="step">
            <h3>메뉴 HTML에 데이터 속성 추가</h3>
            <p>메뉴 링크에 GTM이 추적할 수 있는 데이터 속성을 추가해야 합니다.</p>
            
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">복사</button>
&lt;!-- 기존 메뉴 코드 --&gt;
&lt;a href="/about"&gt;회사소개&lt;/a&gt;

&lt;!-- GTM 추적을 위한 수정된 코드 --&gt;
&lt;a href="/about" 
   <span class="highlight">data-gtm-menu-type="main"</span>
   <span class="highlight">data-gtm-menu-category="회사정보"</span>
   <span class="highlight">data-gtm-menu-label="회사소개"</span>
   <span class="highlight">data-gtm-menu-position="1"</span>
   class="gtm-menu-item"&gt;
   회사소개
&lt;/a&gt;
            </div>
        </div>

        <div class="step">
            <h3>Laravel Blade 템플릿 수정 예시</h3>
            <p>resources/views/components/mega-menu/navigation.blade.php 파일 수정:</p>
            
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">복사</button>
@foreach($menuData->items as $index => $item)
    &lt;a href="{{ $item->url }}"
       <span class="highlight">data-gtm-menu-type="{{ $item->is_mega_menu ? 'mega' : 'simple' }}"</span>
       <span class="highlight">data-gtm-menu-category="{{ $item->title }}"</span>
       <span class="highlight">data-gtm-menu-label="{{ $item->title }}"</span>
       <span class="highlight">data-gtm-menu-position="{{ $index + 1 }}"</span>
       <span class="highlight">class="gtm-menu-item {{ $item->css_class }}"</span>&gt;
       {{ $item->title }}
    &lt;/a&gt;
@endforeach
            </div>
        </div>

        <h2 id="step2">2️⃣ GTM 변수 설정</h2>
        
        <div class="step">
            <h3>A. 데이터 레이어 변수 생성</h3>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>변수 이름</th>
                            <th>변수 유형</th>
                            <th>데이터 레이어 변수 이름</th>
                            <th>용도</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>DLV - Menu Type</td>
                            <td>데이터 영역 변수</td>
                            <td>menuType</td>
                            <td>메뉴 유형 (main/sub/mega)</td>
                        </tr>
                        <tr>
                            <td>DLV - Menu Category</td>
                            <td>데이터 영역 변수</td>
                            <td>menuCategory</td>
                            <td>메뉴 카테고리</td>
                        </tr>
                        <tr>
                            <td>DLV - Menu Label</td>
                            <td>데이터 영역 변수</td>
                            <td>menuLabel</td>
                            <td>클릭된 메뉴 이름</td>
                        </tr>
                        <tr>
                            <td>DLV - Menu URL</td>
                            <td>데이터 영역 변수</td>
                            <td>menuURL</td>
                            <td>메뉴 링크 URL</td>
                        </tr>
                        <tr>
                            <td>DLV - Menu Position</td>
                            <td>데이터 영역 변수</td>
                            <td>menuPosition</td>
                            <td>메뉴 위치 순서</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="step">
            <h3>B. DOM 요소 변수 생성 (대안)</h3>
            <p>데이터 레이어를 사용하지 않고 DOM 속성을 직접 읽는 방법:</p>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>변수 이름</th>
                            <th>변수 유형</th>
                            <th>속성 이름</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>DOM - Menu Type</td>
                            <td>DOM 요소</td>
                            <td>data-gtm-menu-type</td>
                        </tr>
                        <tr>
                            <td>DOM - Menu Category</td>
                            <td>DOM 요소</td>
                            <td>data-gtm-menu-category</td>
                        </tr>
                        <tr>
                            <td>DOM - Menu Label</td>
                            <td>DOM 요소</td>
                            <td>data-gtm-menu-label</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <h2 id="step3">3️⃣ GTM 트리거 생성</h2>
        
        <div class="step">
            <h3>클릭 트리거 설정</h3>
            
            <ol>
                <li><strong>트리거 이름:</strong> Menu Click - All</li>
                <li><strong>트리거 유형:</strong> 클릭 - 모든 요소</li>
                <li><strong>이 트리거는 다음 경우에 실행:</strong> 일부 클릭</li>
                <li><strong>조건:</strong>
                    <ul>
                        <li>Click Classes 포함 "gtm-menu-item"</li>
                        <li>또는</li>
                        <li>Click Element 일치 CSS 선택자 "[data-gtm-menu-type]"</li>
                    </ul>
                </li>
            </ol>
            
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">복사</button>
트리거 조건 (GTM 설정):
- Click Classes contains "gtm-menu-item"
- OR
- Click Element matches CSS selector "[data-gtm-menu-type]"
            </div>
        </div>

        <h2 id="step4">4️⃣ GTM 태그 생성</h2>
        
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab(event, 'ga4')">GA4 이벤트</button>
                <button class="tab-button" onclick="showTab(event, 'custom')">커스텀 HTML</button>
                <button class="tab-button" onclick="showTab(event, 'dataLayer')">데이터 레이어 푸시</button>
            </div>
            
            <div id="ga4" class="tab-content active">
                <h3>GA4 이벤트 태그</h3>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">복사</button>
태그 이름: GA4 - Menu Click Event
태그 유형: Google Analytics: GA4 이벤트
구성 태그: GA4 구성 (기존 태그 선택)

이벤트 이름: menu_click

이벤트 매개변수:
- menu_type: {{DOM - Menu Type}}
- menu_category: {{DOM - Menu Category}}
- menu_label: {{DOM - Menu Label}}
- menu_url: {{Click URL}}
- menu_position: {{DOM - Menu Position}}
- page_location: {{Page URL}}
- page_title: {{Page Title}}

트리거: Menu Click - All
                </div>
            </div>
            
            <div id="custom" class="tab-content">
                <h3>커스텀 HTML 태그 (JavaScript)</h3>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">복사</button>
&lt;script&gt;
(function() {
    // 클릭된 요소 가져오기
    var clickedElement = {{Click Element}};
    
    // 데이터 속성 읽기
    var menuData = {
        'event': 'menu_click',
        'menuType': clickedElement.getAttribute('data-gtm-menu-type'),
        'menuCategory': clickedElement.getAttribute('data-gtm-menu-category'),
        'menuLabel': clickedElement.getAttribute('data-gtm-menu-label'),
        'menuPosition': clickedElement.getAttribute('data-gtm-menu-position'),
        'menuURL': clickedElement.href || '',
        'timestamp': new Date().toISOString()
    };
    
    // 데이터 레이어에 푸시
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push(menuData);
    
    // 콘솔 로그 (디버깅용)
    console.log('GTM Menu Click:', menuData);
})();
&lt;/script&gt;
                </div>
            </div>
            
            <div id="dataLayer" class="tab-content">
                <h3>웹사이트에 추가할 JavaScript 코드</h3>
                
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">복사</button>
&lt;script&gt;
document.addEventListener('DOMContentLoaded', function() {
    // 모든 메뉴 항목에 이벤트 리스너 추가
    document.querySelectorAll('.gtm-menu-item').forEach(function(menuItem) {
        menuItem.addEventListener('click', function(e) {
            // GTM 데이터 레이어에 이벤트 푸시
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'menu_click',
                'menuType': this.getAttribute('data-gtm-menu-type'),
                'menuCategory': this.getAttribute('data-gtm-menu-category'),
                'menuLabel': this.getAttribute('data-gtm-menu-label'),
                'menuPosition': this.getAttribute('data-gtm-menu-position'),
                'menuURL': this.href,
                'pageURL': window.location.href,
                'pageTitle': document.title
            });
        });
    });
    
    // 동적으로 추가되는 메뉴를 위한 이벤트 위임
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('gtm-menu-item') || 
            e.target.closest('.gtm-menu-item')) {
            
            var menuItem = e.target.classList.contains('gtm-menu-item') 
                          ? e.target 
                          : e.target.closest('.gtm-menu-item');
            
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'menu_click_delegated',
                'menuType': menuItem.getAttribute('data-gtm-menu-type'),
                'menuCategory': menuItem.getAttribute('data-gtm-menu-category'),
                'menuLabel': menuItem.getAttribute('data-gtm-menu-label'),
                'menuPosition': menuItem.getAttribute('data-gtm-menu-position'),
                'menuURL': menuItem.href
            });
        }
    });
});
&lt;/script&gt;
                </div>
            </div>
        </div>

        <h2 id="step5">5️⃣ 테스트 및 검증</h2>
        
        <div class="step">
            <h3>A. GTM 미리보기 모드</h3>
            <ol>
                <li>GTM 관리 화면에서 "미리보기" 버튼 클릭</li>
                <li>웹사이트 URL 입력: https://ai-med.co.kr</li>
                <li>메뉴를 클릭하여 이벤트 발생 확인</li>
                <li>Tag Assistant에서 발생한 이벤트 확인</li>
            </ol>
        </div>

        <div class="step">
            <h3>B. 브라우저 콘솔 테스트</h3>
            
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">복사</button>
// 콘솔에서 데이터 레이어 확인
console.log(window.dataLayer);

// 테스트 이벤트 발생
window.dataLayer.push({
    'event': 'test_menu_click',
    'menuLabel': '테스트 메뉴',
    'menuCategory': '테스트 카테고리'
});

// GTM 로드 확인
console.log(typeof google_tag_manager !== 'undefined' ? 'GTM 로드됨' : 'GTM 없음');
            </div>
        </div>

        <div class="step">
            <h3>C. GA4 실시간 보고서</h3>
            <ol>
                <li>GA4 관리 화면 접속</li>
                <li>보고서 → 실시간 → 이벤트</li>
                <li>"menu_click" 이벤트 확인</li>
                <li>이벤트 매개변수 확인</li>
            </ol>
        </div>

        <h2 id="step6">6️⃣ 디버깅 및 문제 해결</h2>
        
        <div class="warning">
            <h3>⚠️ 자주 발생하는 문제</h3>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>문제</th>
                            <th>원인</th>
                            <th>해결 방법</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>이벤트가 발생하지 않음</td>
                            <td>트리거 조건 불일치</td>
                            <td>CSS 선택자 확인, 클래스명 확인</td>
                        </tr>
                        <tr>
                            <td>데이터가 undefined</td>
                            <td>데이터 속성 오타</td>
                            <td>HTML의 data-* 속성명 확인</td>
                        </tr>
                        <tr>
                            <td>중복 이벤트 발생</td>
                            <td>이벤트 버블링</td>
                            <td>e.stopPropagation() 추가</td>
                        </tr>
                        <tr>
                            <td>GA4에서 안 보임</td>
                            <td>필터 설정</td>
                            <td>내부 트래픽 필터 확인</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="success">
            <h3>✅ 체크리스트</h3>
            <ul style="list-style-type: none;">
                <li>☐ HTML에 data-gtm-* 속성 추가</li>
                <li>☐ GTM 변수 생성 (5개)</li>
                <li>☐ GTM 트리거 생성</li>
                <li>☐ GTM 태그 생성</li>
                <li>☐ 미리보기 모드에서 테스트</li>
                <li>☐ GA4 실시간 보고서 확인</li>
                <li>☐ GTM 컨테이너 게시</li>
            </ul>
        </div>

        <h2>📊 예상 데이터 구조</h2>
        
        <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">복사</button>
// GA4에서 수집되는 데이터 예시
{
    "event_name": "menu_click",
    "event_params": {
        "menu_type": "mega",
        "menu_category": "제품",
        "menu_label": "AI 솔루션",
        "menu_position": "2",
        "menu_url": "/products/ai-solution",
        "page_location": "https://ai-med.co.kr/",
        "page_title": "AI-MED Korea - Home",
        "engagement_time_msec": 1000
    },
    "user_properties": {
        "user_id": "anonymous_12345",
        "session_id": "1234567890"
    }
}
        </div>

        <h2>🎯 Laravel 통합 코드</h2>
        
        <div class="step">
            <h3>app.blade.php에 추가할 코드</h3>
            
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">복사</button>
{{-- GTM Menu Tracking --}}
@if(config('app.env') === 'production')
&lt;script&gt;
document.addEventListener('DOMContentLoaded', function() {
    // 메뉴 클릭 추적
    const trackMenuClick = function(element) {
        if (!window.dataLayer) return;
        
        const menuData = {
            'event': 'menu_click',
            'menuType': element.dataset.gtmMenuType || 'unknown',
            'menuCategory': element.dataset.gtmMenuCategory || 'unknown',
            'menuLabel': element.dataset.gtmMenuLabel || element.textContent.trim(),
            'menuPosition': element.dataset.gtmMenuPosition || '0',
            'menuURL': element.href || '',
            'timestamp': new Date().toISOString(),
            'userId': '{{ auth()->id() ?? "guest" }}',
            'locale': '{{ app()->getLocale() }}'
        };
        
        window.dataLayer.push(menuData);
        
        // 디버그 모드
        @if(config('app.debug'))
        console.log('Menu Click Tracked:', menuData);
        @endif
    };
    
    // 이벤트 위임 방식
    document.body.addEventListener('click', function(e) {
        const menuItem = e.target.closest('[data-gtm-menu-type]');
        if (menuItem) {
            trackMenuClick(menuItem);
        }
    });
});
&lt;/script&gt;
@endif
            </div>
        </div>
    </div>

    <script>
        function copyCode(button) {
            const codeBlock = button.parentElement.querySelector('pre') || button.parentElement;
            const text = codeBlock.textContent.replace('복사', '').trim();
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = '✓ 복사됨';
                button.style.background = '#22c55e';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#2563eb';
                }, 2000);
            });
        }
        
        function showTab(event, tabId) {
            const buttons = document.querySelectorAll('.tab-button');
            const contents = document.querySelectorAll('.tab-content');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
    </script>
</body>
</html>